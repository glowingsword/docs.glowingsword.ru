---
title: 'Проверка и изменение значений ratelimit для почтвоых аккаунтов Exim'
authors: 
 - glowingsword
tags:
 - Exim
date: 2020-12-30
---
# Проверка и изменение значений ratelimit для почтвоых аккаунтов Exim

## Получаем нужное значение счётчика для интересующей нас записи

Смотрим значение счётчиков командой

```bash
exim_dumpdb /var/spool/exim/ ratelimit
```

## Изменение интересующей нас записи

Изменяем записи с производится помощью exim_fixdb.

Если нас интересуют значения ratelimit базы данных exim, выполняем

```bash
exim_fixdb /var/spool/exim/ ratelimit
```

после чего видим приглашение 
```yaml
Modifying Exim hints database /var/spool/exim//db/ratelimit
> 
```
Соответственно, утилита готова к произведению изменений в базе Exim. 

## Изменяем или удаляем значение ratelimit у нужной нам записи

### Выбираем запись для изменения или удаления
Пример изменения значение счётчика для записи ==1d/per_mail/some_user_id== с 8292 на 1.

Для начала нам необходимо выбрать запись, что мы будем изменять. 
Находим нужную нам запись находим в выводе упомянутого выше exim_dumpdb.

Нас интересуют строки вида 
```yaml
16-Dec-2020 17:46:16.649236 rate:     11.657 key: 1d/per_mail/some_user_id
```

где some_user_id – какой-то ==IP==,==User ID== или ===e-mail==.

Из этой строки нам необходимо значение параметра key, вида ==1d/per_mail/some_user_id==.

Вводим его в приглаение консоли exim_fixdb

```yaml
> 1d/per_mail/some_user_id
```
и видим в выводе после ввода ==1d/per_mail/some_user_id== что-то на подобие следующего вывода(значения ключей могут отличаться у разных записей, сами ключи должны быть идентичны указанным ниже) 

```yaml
16-Dec-2020 17:46:16
0 time stamp:  16-Dec-2020 17:46:16
1 fract. time: .649236
2 sender rate:  8292.432
```
где строки начинающие с 0,1 и 2 – это значения, которые мы можем изменить.

Нужная нам запись выбрана. Теперь мы можем её удалить или изменить.

### Удаление записи

Вводим ==d== для удаления выбранной ранее записи

```yaml
> d
deleted
```
и выходим из консоли(см. ниже, как выйти из консоли данного приложения).

### Изменение нужной записи

Изменяем нужное значение sender rate по его ключу вида ==2==

```yaml
> 2 1.000 
```

где:
* 2 – ключ(id) интересующей нас записи;
* 1.000 – значение, что мы присваиваем данному счётчику(sender rate).

После ввода этих значений консоль вернёт нам

```bash
17-Aug-2018 13:18:52
0 time stamp:  17-Aug-2018 13:18:52
1 fract. time: .094355
2 sender rate:  1.000
```

### Выход из консоли exim_fixdb
После изменения или удаления записи консоль приложения опять покажет нам приглашение вида ">", чего в появившееся приглашение останется ввести ==q==

```bash
> q
```

для выхода из консоли exim_fixdb для завершения процесса редактирования базы данных exim.

Больше информации по утилитам для работы с базой Exim можно получить с помощью:

* exim_dumpdb
* man exim_fixdb
* man exim_tidydb

Также полезную информацию о данных приложениях можно найти на страницах:
* https://www.lissyara.su/doc/exim/4.62/exim_utilities/ 
* https://web.archive.org/web/20161023201518/https://www.the-hawkes.de/manipulate-exim-retry-database.html

